<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
   <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
     integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
     crossorigin=""></script>
    <link rel="stylesheet" href="index.css"/>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <title>Hangouts@IDE</title>

  </head>

  <body>
    <div class="container">
      <div class="header">
        <h2>Hangout</h2>
        <div>
    <p>Is Singapore a truely boring city? We don't think so. Hangout is a real time web application that tells you where the happenings are at. Leveraging on Dataspark's API, we are able to tell you where the events are. And based on sentiment analysis from social media like Twitter, we can tell you if the event is worth it.</p>
    <small>Remember Artbox? Everyone was there but everyone was writing how small it is.</small>
    <br>
    <div id="mapid"></div>
    </div>
<!-- beginning of js leaflet script  -->
    <script src="./js/subzone.js"></script>
    <script src="./js/leaflet-heat.js"></script>
    <script src="./js/legend.js"></script>
    <script src="./js/event items.js"></script>
    <script>
    //import leaflet-label from 'leaflet-label';
    var map = new L.Map("mapid", {center: [1.3521, 103.8198], zoom: 11.5})
    .addLayer(new L.TileLayer("http://maps-{s}.onemap.sg/v2/Original/{z}/{x}/{y}.png"));
    //access the subzone data from subzone.js
    var subzones = [subzone_information]

    //variable for flag icon
    var flagIcon = L.icon({
    iconUrl: './assets/flag.png',
    shadowUrl: './assets/flag shadow.png',

    iconSize:     [40, 60], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [22, 59], // point of the icon which will correspond to marker's location
    shadowAnchor: [23, 61],  // the same for the shadow
    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });

    //generates the flags needed
    // information about the event will be here also
    function arrayFlag(coordinates){
      for (i = 0; i < coordinates.length; i++) {
        //var canvas = '<canvas id="myCanvas" width="300" height="150"></canvas><script>function t(p,i){var c = document.getElementById(i);var ctx = c.getContext("2d");ctx.beginPath();ctx.rect(20, 20, 150, 100);if(p>=80){ctx.fillStyle = "green";}else if (50<=p<80){ctx.fillStyle = "yellow";}else{ctx.fillStyle = "red";}ctx.fill();} t(51,"myCanvas"); </script>'

          var marker = L.marker([testCoordiantes[i][1],testCoordiantes[i][2]], {icon: flagIcon}).bindPopup("hi")
          marker.on('mouseover', function (e) {
            this.openPopup();
        });
        marker.on('mouseout', function (e) {
            this.closePopup();
        });
          marker.addTo(map);
      }
    }
    var testCoordiantes = [["Macrichite",1.3521, 103.8198],["Somewhere",1.2798070057318836,103.83961460585509]];
    arrayFlag(testCoordiantes);

    L.geoJSON(subzones, {
      style: function(feature) {
        switch (feature.properties.REGION_C) {
            case 'CR': return {color: "#66c2a5"};
            case 'NR': return {color:"#fc8d62"};
            case 'ER' : return {color:"#8da0cb"};
            case 'NER' : return {color:"#e78ac3"};
            case 'WR' :return {color:"#a6d854"};
          }
        },
        onEachFeature: function (feature, layer) {
          layer.bindPopup('<h4>'+feature.properties.SUBZONE_N[0]+feature.properties.SUBZONE_N.substring(1,feature.properties.SUBZONE_N.length).toLowerCase()+'<h4>');
          }
         }).addTo(map);

    //legend

    var legend = legend;
    legend.addTo(map);

    </script>
    <footer id="footer">
      <div class="container">
        <span class="text-muteds">Built using Leaflet,GeoJson,OneMap Leaflet Maps. Data from data.gov.sg, DataSpark API, the web.</span>
      </div>
    </footer>

  </body>
</html>
